-- CICD-VAR: ADMIN_ROLE_NAME
-- CICD-VAR: IMPLEMENTATION_DB_NAME
-- CICD-VAR: PRESENTATION_DB_NAME
-- CICD-VAR: WAREHOUSE_NAME

BEGIN
    USE ROLE {ADMIN_ROLE_NAME};
    USE WAREHOUSE {WAREHOUSE_NAME};
    USE DATABASE {PRESENTATION_DB_NAME};

    CREATE OR REPLACE VIEW SALESFORCE.ENERGY_USAGE
    AS
    SELECT EnergyType, YEAR, PostCode, MeterCount, TotalConsumption, MeanConsumption, MedianConsumption
    FROM {IMPLEMENTATION_DB_NAME}.SALESFORCE_LOAD.ENERGY_USAGE;

    GRANT OWNERSHIP ON VIEW SALESFORCE.ENERGY_USAGE TO ROLE {ADMIN_ROLE_NAME};
END;
